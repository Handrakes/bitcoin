# bitcoin

public key : 공개키는 주로 전송받을 때 주소로 활용됨 ( 계좌번호 같은 역할 )
private key : 전송받은 비트코인을 사용할 때 디지털 서명으로 이용됨 

비트코인 소비 : 공개키와 개인키를 사용

어차피 공개키는 개인키를 기반으로 생성되기 때문에, 개인키만 있어도 상관은 없다. 
개인키를 한번 분실하면 영영 찾을 수 없어...

주소는 공개키로부터 생성됨(숫자 1로 시작함)

비트코인 지갑에는 비트코인이 아닌 키가 들어있다. 각 사용자는 키가 들어 있는 지갑을 사용한다. 
실제로 지갑은 개인키 / 공개키 쌍이 담겨있는 열쇠고리라고 할 수 있다. 
사용자들은 키를 이용해서 거래에 서명함으로써 자신들이 거래 출력값을 소유하고 있음을 입증한다. 
비트코인은 블록체인 네트워크 내에 존재한다. 

Pos(Proof of Stake) : 지분 증명, 지분이 이만큼 있으니 투표권을 줄게! like 돈 주고 투표권 사는 느낌;

data를 거래할 수 있게 된다. (p2p) 개인간의 데이터를 블록체인 형태로 줌 : hash code 형태로 주고 돈을 받는 것

지갑 : 비트코인이 들어있는게 아닌 키가 들어있음. 그 키를 사용해서 서명하면, 비트코인 네트워크에서 코인을 사용할 수 있는 것. 개인키 - 공개키 쌍을 가짐
-> 지갑은 일종의 키체인(열쇠고리)인 셈

결정적 지갑에는 종자(seed)가 존재하고, 종자에서 개인키를 얻을 수 있다.  --> HD 지갑

HD 지갑은 근원 종자 한개로부터 생성된다. 이 종자는 연상기호에서 생성된다. 이 root seed 를 사용하면 어떤 HD 지갑에서도 HD 지갑을 재현할 수 있다. 
근원 종자만을 전송하여 백업, 복원 export import 가 가능하다. 

root seed로 master private key(->master public key), master chain code 생성
부모키로부터 자식키를 유도할 수 있음 

모든 사용자들에 대해서 주문 마다 ( 송금 마다 ) 주소를 추출할 수 있다. 


--- transaction 거래
거래 출력값 ( transaction output ) : 모든 거래는 UTXO 세트 내의 상태 변환을 의미한다. 
지갑은 지갑이 관리하고 있는 키로 소비할 수 있는 UTXO의 값ㅇ을 더해서 사용자의 잔액을 계산한다. 출력값들은 개별적이고 나눌 수 없다. UTXO는 거래에서 통째로 소비만 될 수 있다. 

모든 비트코인 거래는 출력값을 생성한다. 출력값은 비트코인 장부에 기록된다. 

네트워크로의 전송이나 해싱, 디스크 상의 저장 등을 위해 바이트 스트림 표현 방식으로 전환하는 과정을 직렬화(serialization)이라고 한다. 

- 입력
거래를 빌드하기 위해 지갑은 통제하고 있는 UTXO 중에서 하나를 선택한다.
지갑은 참조된 UTXO를 추적하고, 그에 대한 잠금 스트립트를 점검한 후에 잠금 스크립트를 이용해서 해제 스크립트를 만든다.
거래 수수료는 의무사항은 아니지만, 수수료가 클수록 우선적으로 처리될 확률이 높아진다.
수수료가 따로 표시되지는 않고, 입력 = 출력 + 수수료 이다.

비트코인 거래 유효화 엔진은 2가지 script가 중요하다. 잠금 script와 해제 script이다.
잠금 스크립트는 출력값에 위치하고 출력값을 소비하기 위해 충족되어야하는 요건을 명시하고 있다. 보통 잠금 스크립트에는 공개키 혹은 주소가 담겨있다. 
대부분 scriptPubKey 로 표현된다.

해제 스크립트는 잠금 스크립트가 출력값에 놓아둔 조건을 '해결' 하거나 충족시켜서 출력값이 소비될 수 있도록 하는 스크립트이다. 모든 거래의 입력값에 들어있다. 
대부분 개인키로부터 생성한 디지털 서명이 담겨있다. 

- 다음은 비트코인 검증 flow이다. 
잠금 스크립트와 해제 스크립트를 함께 실행해서 거래를 유효화 시킨다. 
입력 값에는 해제 스크립트 -> 입력값은 이전에 존재했던 UTXO를 참조 -> UTXO로 부터 잠금 스크립트를 복사.
-> 해제가 잠금의 조건을 충족하는 경우에 해당 입력값이 "유효"해진다.
출력값의 조건을 명확히 충족해야 해당 UTXO가 거래된다.
스크립트는 stack 구조. 















